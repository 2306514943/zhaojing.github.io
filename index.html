<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ—¥å¿«ä¹ - æ¨ç‘</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #FFC0CB;
            font-family: "æ¥·ä½“", cursive;
            touch-action: manipulation;
        }

        .page {
            position: absolute;
            width: 100%;
            height: 100vh;
            display: none;
        }

        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }

        .btn {
            font-size: 1.5rem;
            padding: 10px 30px;
            margin: 10px;
            border-radius: 20px;
            background: #FF69B4;
            color: white;
            border: none;
            cursor: pointer;
            font-family: "æ¥·ä½“";
        }

        .message-box {
            position: relative;
            max-width: 80%;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            text-align: center;
            font-size: 1.2rem;
            animation: textExpand 1s both;
        }

        /* è›‹ç³•å®¹å™¨ */
        #cakeContainer {
            position: relative;
            height: 70vh;
            margin-top: 5vh;
        }

        .cake-layer {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 15px 15px 0 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: cakeDrop 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        }

        /* èœ¡çƒ›æ ·å¼ */
        .candle {
            position: absolute;
            bottom: 100%;
            width: 28px;
            height: 80px;
            background: linear-gradient(to bottom, #FFD700, #FFA500);
            border-radius: 5px 5px 0 0;
            animation: candleGrow 0.5s 3.2s cubic-bezier(0.18, 0.89, 0.32, 1.28) both;
        }

        .flame {
            position: absolute;
            width: 12px;
            height: 20px;
            background: linear-gradient(to bottom, #FF4500 50%, #FFA500 100%);
            border-radius: 50% 50% 35% 35%;
            left: 50%;
            transform: translateX(-50%);
            animation: flameFlicker 0.1s infinite alternate;
        }

        .page3-buttons {
            position: fixed;
            bottom: 5%;
            width: 100%;
            text-align: center;
        }

        @keyframes cakeDrop {
            0% { top: -100px; opacity: 0; }
            100% { top: var(--target-top); opacity: 1; }
        }

        @keyframes candleGrow {
            0% { transform: scaleY(0); }
            100% { transform: scaleY(1); }
        }

        @keyframes flameFlicker {
            0% { transform: translateX(-50%) scale(0.9) rotate(-3deg); }
            100% { transform: translateX(-50%) scale(1.1) rotate(3deg); }
        }

        @keyframes textExpand {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- é¡µé¢1ï¼šæ—¥æœŸè¾“å…¥ -->
    <div id="page1" class="page">
        <h1 style="color:white;text-align:center;font-size:3rem">ç”Ÿæ—¥å¿«ä¹</h1>
        <h2 style="color:white;text-align:center">äº²çˆ±çš„æ¨ç‘</h2>
        <div style="text-align:center;margin-top:30vh">
            <input id="dateInput" type="date" style="font-size:1.5rem;padding:5px">
            <button class="btn" onclick="checkDate()">ç¡®è®¤</button>
        </div>
    </div>

    <!-- é¡µé¢2ï¼šæ–‡å­—åŠ¨ç”» -->
    <div id="page2" class="page">
        <div id="textAnimation" style="color:white;text-align:center;margin-top:40vh"></div>
    </div>

    <!-- é¡µé¢3ï¼šè›‹ç³•åŠ¨ç”» -->
    <div id="page3" class="page">
        <div id="cakeContainer"></div>
        <div class="page3-buttons">
            <button class="btn" onclick="showPage4()">å–œæ¬¢</button>
            <button class="btn" onclick="showPopup()">ä¸å–œæ¬¢</button>
        </div>
    </div>

    <!-- é¡µé¢4ï¼šç¥ç¦è¯­ -->
    <div id="page4" class="page">
        <div id="messages" style="padding:20px"></div>
    </div>

    <!-- å¼¹çª— -->
    <div id="popup" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5)">
        <div style="background:#FFC0CB;width:80%;margin:20% auto;padding:20px;border-radius:15px">
            <h2 style="text-align:center">ç”Ÿæ—¥å¿«ä¹ï¼</h2>
            <button class="btn" style="display:block;margin:20px auto" onclick="closePopup()">ç¡®å®š</button>
        </div>
    </div>

    <script>
        // å¿ƒå½¢é£˜è½åŠ¨ç”»
        class HeartFall {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.hearts = [];
                this.resize();
                this.init();
                window.addEventListener('resize', () => this.resize());
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            init() {
                for (let i = 0; i < 30; i++) {
                    this.hearts.push(this.createHeart());
                }
                this.animate();
            }

            createHeart() {
                return {
                    x: Math.random() * this.canvas.width,
                    y: Math.random() * -this.canvas.height,
                    size: Math.random() * 20 + 10,
                    speed: Math.random() * 2 + 1,
                    angle: Math.random() * Math.PI/4 - Math.PI/8,
                    swing: Math.random() * 0.8 - 0.4
                };
            }

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.hearts.forEach(heart => {
                    heart.y += heart.speed;
                    heart.x += heart.swing * Math.cos(heart.angle);
                    heart.angle += 0.02;

                    if (heart.y > this.canvas.height + 50) {
                        Object.assign(heart, this.createHeart());
                        heart.y = -50;
                    }

                    this.ctx.save();
                    this.ctx.translate(heart.x, heart.y);
                    this.ctx.rotate(heart.angle);
                    this.ctx.font = `${heart.size}px Arial`;
                    this.ctx.fillText('â¤', 0, 0);
                    this.ctx.restore();
                });

                requestAnimationFrame(() => this.animate());
            }
        }

        // è›‹ç³•åŠ¨ç”»ç±»
        class CakeAnimation {
            constructor(container) {
                this.container = container;
                this.layers = [
                    { width: 320, height: 80, color: '#FF0066', delay: 0 },   // æœ€å¤§å±‚
                    { width: 280, height: 70, color: '#FF4081', delay: 800 }, // ç¬¬äºŒå±‚
                    { width: 240, height: 60, color: '#FF80AB', delay: 1600 },// ç¬¬ä¸‰å±‚
                    { width: 200, height: 50, color: '#FFB6C1', delay: 2400 } // æœ€é¡¶å±‚
                ];
                this.currentBase = 0;
                this.createLayers();
                setTimeout(() => this.addCandles(), 3200);
            }

            createLayers() {
                const containerHeight = this.container.offsetHeight;
                
                this.layers.forEach(layer => {
                    const div = document.createElement('div');
                    div.className = 'cake-layer';
                    
                    // è®¡ç®—ç›®æ ‡ä½ç½®ï¼šåç»­å±‚å åœ¨å‰ä¸€å±‚ä¸Šæ–¹
                    const targetTop = containerHeight - this.currentBase - layer.height;
                    
                    div.style.cssText = `
                        width: ${layer.width}px;
                        height: ${layer.height}px;
                        background: ${layer.color};
                        --target-top: ${targetTop}px;
                        animation-delay: ${layer.delay}ms;
                    `;

                    this.container.appendChild(div);
                    this.currentBase += layer.height - 10; // å±‚å åç§»é‡
                });
            }

            addCandles() {
                const texts = ['æ°¸', 'è¿œ', '1', '8'];
                const positions = [25, 75, 125, 175]; // åŸºäº200pxå®½åº¦
                const topLayer = this.container.lastElementChild;

                texts.forEach((text, i) => {
                    const candle = document.createElement('div');
                    candle.className = 'candle';
                    candle.style.left = `${positions[i]}px`;

                    // ç«ç„°
                    const flame = document.createElement('div');
                    flame.className = 'flame';
                    
                    // æ–‡å­—
                    const textDiv = document.createElement('div');
                    textDiv.style.cssText = `
                        position: absolute;
                        bottom: 110%;
                        left: 50%;
                        transform: translateX(-50%);
                        color: white;
                        font-family: æ¥·ä½“;
                        font-size: 22px;
                        text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
                    `;
                    textDiv.textContent = text;

                    candle.appendChild(flame);
                    candle.appendChild(textDiv);
                    topLayer.appendChild(candle);
                });
            }
        }

        // é¡µé¢æ§åˆ¶
        let currentPage = 1;
        const canvas = document.createElement('canvas');
        canvas.id = 'canvas';
        document.body.appendChild(canvas);
        new HeartFall(canvas);

        const messages = [
            "ğŸ‰ğŸ‚âœ¨ äº²çˆ±çš„æœ‹å‹ï¼Œç”Ÿæ—¥å¿«ä¹ï¼ âœ¨ğŸ‚ğŸ‰",
            "ğŸŒ¹ åœ¨è¿™ä¸ªç‰¹åˆ«çš„æ—¥å­é‡Œï¼Œæ„¿ä½ åƒç«ç‘°ä¸€æ ·ç»½æ”¾ ğŸŒ¹",
            "ğŸ’– æ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡çˆ±ä¸å¹¸ç¦ ğŸ’–",
            "ğŸŒŸ æ„¿ä½ æ‰€æœ‰çš„æ¢¦æƒ³éƒ½èƒ½å®ç°ï¼Œæ‰€æœ‰çš„å¸Œæœ›éƒ½èƒ½å¦‚æ„¿ ğŸŒŸ",
            "ğŸ æ„¿ä½ æ”¶åˆ°æ»¡æ»¡çš„ç¥ç¦å’ŒæƒŠå–œ ğŸ",
            "ğŸŒ¸ æ„¿ä½ æ°¸è¿œå¹´è½»ç¾ä¸½ï¼Œç¬‘å®¹å¸¸åœ¨ ğŸŒ¸",
            "ğŸ° ç¥ä½ ç”Ÿæ—¥å¿«ä¹ï¼Œæ„¿æˆ‘ä»¬çš„å‹è°Šé•¿å­˜ ğŸ°"
        ];

        function showPage(pageNum) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.getElementById(`page${pageNum}`).style.display = 'block';
            currentPage = pageNum;
        }

        function checkDate() {
            const inputDate = new Date(document.getElementById('dateInput').value);
            const today = new Date();
            if (inputDate.getMonth() === 3 && inputDate.getDate() === 7 && 
                today.getMonth() === 3 && today.getDate() === 7) {
                startAnimation();
            } else {
                alert('ğŸŒ¸ è™½ç„¶ä¸æ˜¯ä½ çš„ç”Ÿæ—¥ï¼Œä½†ç¥ä½ ç”Ÿæ´»æ„‰å¿«ï¼ ğŸŒ¸');
            }
        }

        async function startAnimation() {
            showPage(2);
            const texts = ["Hi äº² çˆ± çš„", "æ¨ ç‘", "ç¥ ä½ ", "ç”Ÿ æ—¥ å¿« ä¹", "Happy Birthday", "3", "2", "1"];
            const elem = document.getElementById('textAnimation');

            for (let text of texts) {
                elem.innerHTML = '';
                for (let char of text) {
                    elem.innerHTML += `<span style="display:inline-block;width:40px">${char}</span>`;
                    await new Promise(r => setTimeout(r, 50));
                }
                await new Promise(r => setTimeout(r, 1000));
            }
            showPage(3);
            new CakeAnimation(document.getElementById('cakeContainer'));
        }

        function showPage4() {
            showPage(4);
            const container = document.getElementById('messages');
            messages.forEach((msg, i) => {
                setTimeout(() => {
                    const div = document.createElement('div');
                    div.className = 'message-box';
                    div.style.animation = `textExpand 1s ${i*1.5}s both`;
                    div.textContent = msg;
                    container.appendChild(div);
                }, i * 1500);
            });
        }

        function showPopup() {
            document.getElementById('popup').style.display = 'block';
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        // åˆå§‹åŒ–æ˜¾ç¤ºç¬¬ä¸€é¡µ
        showPage(1);
    </script>
</body>
</html>